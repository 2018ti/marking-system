<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>文本编辑页面</title>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="css/marking.css">

    <script type="text/javascript" src="js/JQuery/jquery.js"></script>
    <script type="text/javascript" src="js/bootstrap/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/article.css" />
    <style>
        .red {
            color: red;
        }
        
        .text {
            width: 100%;
            min-height: 120px;
            max-height: 300px;
            margin-left: auto;
            margin-right: auto;
            padding: 3px;
            outline: 0;
            border: 1px solid #a0b3d6;
            font-size: 20px;
            line-height: 24px;
            word-wrap: break-word;
            overflow-x: hidden;
            overflow-y: auto;
            border-color: rgba(82, 168, 236, 0.8);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1), 0 0 8px rgba(82, 168, 236, 0.6);
        }
    </style>
</head>

<body>
    <div class="container">
        <div id="div1">
            <img src="picture/bannerbg.png">
        </div>
        <div class="top">
            <div class="top-left">
                <a href="/user.html" class="top-art">个人中心</a>
            </div>
        </div>
        <div class="main">
            <!-- <div class="txt">
                <div id="text">wegwegew围观的地点在哪里</textarea>
                </div>
                <div class="operate">

                </div>
            </div> -->
            <div class="text" contenteditable="true" id="text">
            </div>
            <div class="form-group">
                <input type="button" value="保存修改" class="btn btn-primary btn-lg" style="margin-left:250px;" id="save">
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <div class="list-group">
                        <div class="panel panel-default" style="width:500px;">
                            <div class="panel-heading" id="t">触发词</div>
                            <div class="panel-body" id="w">
                            </div>
                        </div>
                        <div class="panel panel-default" style="width:500px;">
                            <div class="panel-heading" id="t1">1</div>
                            <div class="panel-body" id="w1">

                            </div>
                        </div>
                        <div class="panel panel-default" style="width:500px;">
                            <div class="panel-heading" id="t2">2</div>
                            <div class="panel-body" id="w2">
                            </div>
                        </div>
                        <div class="panel panel-default" style="width:500px;">
                            <div class="panel-heading" id="t3">3</div>
                            <div class="panel-body" id="w3">
                            </div>
                        </div>
                        <div class="panel panel-default" style="width:500px;">
                            <div class="panel-heading" id="t4">4</div>
                            <div class="panel-body" id="w4">

                            </div>
                        </div>
                    </div>
                </div>
                <div class="col=lg-6">
                    <div class="list-group" style="margin-left:100px;">
                        <div class="btn-group">
                            <button type="button" class="btn btn-default" id="event1">会见会谈</button>
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="caret"></span>
                        <span class="sr-only">Toggle Dropdown</span>
                    </button>
                            <ul class="dropdown-menu">
                                <li><button type="button" class="btn btn-default" id="event1_person1">参与方1</button></li>
                                <li role="separator" class="divider"></li>
                                <li><button type="button" class="btn btn-default" id="event1_person2">参与方2</button></li>
                                <li role="separator" class="divider"></li>
                                <li><button type="button" class="btn btn-default" id="event1_date">时间</button></li>
                                <li role="separator" class="divider"></li>
                                <li><button type="button" class="btn btn-default" id="event1_place">地点</button></li>
                            </ul>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn btn-primary" id="event2">签署文件</button>
                            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="caret"></span>
                        <span class="sr-only">Toggle Dropdown</span>
                    </button>
                            <ul class="dropdown-menu">
                                <li><button type="button" class="btn btn-primary" id="event2_person">签署方</button></li>
                                <li role="separator" class="divider"></li>
                                <li><button type="button" class="btn btn-primary" id="event2_document">文件</button></li>
                                <li role="separator" class="divider"></li>
                                <li><button type="button" class="btn btn-primary" id="event2_date">签署时间</button></li>
                                <li role="separator" class="divider"></li>
                                <li><button type="button" class="btn btn-primary" id="event2_place">签署地点</button></li>
                            </ul>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn btn-success" id="event3">设施启动</button>
                            <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="caret"></span>
                        <span class="sr-only">Toggle Dropdown</span>
                    </button>
                            <ul class="dropdown-menu">
                                <li><button type="button" class="btn btn-success" id="event3_person">设施修建方</button></li>
                                <li role="separator" class="divider"></li>
                                <li><button type="button" class="btn btn-success" id="event3_name">设施名称</button></li>
                                <li role="separator" class="divider"></li>
                                <li><button type="button" class="btn btn-success" id="event3_date">启动时间</button></li>
                                <li role="separator" class="divider"></li>
                                <li><button type="button" class="btn btn-success" id="event3_place">设施地点</button></li>
                            </ul>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn btn-info" id="event4">举行活动</button>
                            <button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="caret"></span>
                        <span class="sr-only">Toggle Dropdown</span>
                    </button>
                            <ul class="dropdown-menu">
                                <li><button type="button" class="btn btn-info" id="event4_person">举办方</button></li>
                                <li role="separator" class="divider"></li>
                                <li><button type="button" class="btn btn-info" id="event4_name">活动名称</button></li>
                                <li role="separator" class="divider"></li>
                                <li><button type="button" class="btn btn-info" id="event4_place">活动地点</button></li>
                                <li role="separator" class="divider"></li>
                                <li><button type="button" class="btn btn-info" id="event4_date">活动时间</button></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
</body>
</script>
<script type="text/javascript">
    var markingId = getQueryString("markingId");

    function getQueryString(name) {
        var result = window.location.search.match(new RegExp("[\?\&]" + name + "=([^\&]+)", "i"));
        if (result == null || result.length < 1) {
            return "";
        }
        return result[1];
    }
    var word = '';
    var oContent = document.getElementById('text');
    oContent.onmouseup = function() {
        word = selectText(); //鼠标选中文字
    };

    function selectText() {
        if (document.Selection) {
            //ie浏览器
            return document.selection.createRange().text;
        } else {
            //标准浏览器
            return window.getSelection().toString();
        }
    }

    $(document).ready(function() {

        $.ajax({
            url: "/getTxtByMarkingId",
            method: "get",
            dataType: "json",
            data: {
                markingId: markingId,
            },
            //数据渲染到text并改变颜色
            success: function(data) {
                $("#text").text(data["content"]);
                $("#w").html(data['trigger']);
                $("#w1").html(data['marking1']);
                $("#w2").html(data['marking2']);
                $("#w3").html(data['marking3']);
                $("#w4").html(data['marking4']);
                if (data["eventType"] == '会见会谈') {
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace(data['trigger'], '<span style="color: red;" id="trigger">' + data['trigger'] + '</span>');
                    })
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace(data['marking1'], '<span style="color: orange;" id="participant1">' + data['marking1'] + '</span>');
                    })
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace(data['marking2'], '<span style="color: green;" id="participant2">' + data['marking2'] + '</span>');
                    })
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace(data['marking3'], '<span style="color: purple;" id="time">' + data['marking3'] + '</span>');
                    })
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace(data['marking4'], '<span style="color: blue;" id="place">' + data['marking4'] + '</span>');
                    })
                    $("#t1").html('参与方1');
                    $("#t2").html('参与方2');
                    $("#t3").html('时间');
                    $("#t4").html('地点');
                    //---------------------------签署文件
                } else if (data["eventType"] == '签署文件') {
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace(data['trigger'], '<span style="color: red;" id="trigger">' + data['trigger'] + '</span>');
                    })
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace(data['marking1'], '<span style="color: orange;" id="signatory">' + data['marking1'] + '</span>');
                    })
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace(data['marking2'], '<span style="color: purple;" id="file">' + data['marking2'] + '</span>');
                    })
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace(data['marking3'], '<span style="color: green;" id="time">' + data['marking3'] + '</span>');
                    })
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace(data['marking4'], '<span style="color: blue;" id="place">' + data['marking4'] + '</span>');
                    })
                    $("#t1").html('签署方');
                    $("#t2").html('文件');
                    $("#t3").html('签署时间');
                    $("#t4").html('签署地点');

                } else if (data["eventType"] == '设施启用') {
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace(data['trigger'], '<span style="color: red;" id="trigger">' + data['trigger'] + '</span>');
                    })
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace(data['marking1'], '<span style="color: green;" id="constructor">' + data['marking1'] + '</span>');
                    })
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace(data['marking2'], '<span style="color: orange;" id="buildingName">' + data['marking2'] + '</span>');
                    })
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace(data['marking3'], '<span style="color: blue;" id="time">' + data['marking3'] + '</span>');
                    })
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace(data['marking4'], '<span style="color: purple;" id="place">' + data['marking4'] + '</span>');
                    })
                    $("#t1").html('设施修建方');
                    $("#t2").html('设施名称');
                    $("#t3").html('启动时间');
                    $("#t4").html('设施地点');
                } else {
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace(data['trigger'], '<span style="color: red;" id="trigger">' + data['trigger'] + '</span>');
                    })
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace(data['marking1'], '<span style="color: green;" id="holder">' + data['marking1'] + '</span>');
                    })
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace(data['marking2'], '<span style="color: orange;" id="name">' + data['marking2'] + '</span>');
                    })
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace(data['marking3'], '<span style="color: blue;" id="place">' + data['marking3'] + '</span>');
                    })
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace(data['marking4'], '<span style="color: purple;" id="time">' + data['marking4'] + '</span>');
                    })
                    $("#t1").html('举办方');
                    $("#t2").html('活动名称');
                    $("#t3").html('活动地点');
                    $("#t4").html('活动时间');
                }
            }
        })
    });
    $("#event1").click(function() { //点击“会见会谈”按钮，改变表格内容
        $('#text').html(function(i, oldHTML) {
            return oldHTML.replace($("#text").html(), $("#text").text());
        })
        alert(word);
        //若用户此前点击了非会见会谈的事件，再次点击会见会谈时清除之前的标记.
        $("#w").html(word); //触发词
        $("#w1").html(''); //清空表格内容
        $("#w2").html('');
        $("#w3").html('');
        $("#w4").html('');
        $("#t1").html('参与方1');
        if (word != '') {
            $('#text').html(function(i, oldHTML) {
                    return oldHTML.replace(word, '<span style="color: red;" id="trigger">' + word + '</span>');
                }) //将选定文本内容添加上span标签修改样式
        }
        word = '';
        //console.log($("#t1").html());
        $("#event1_person1").click(function() { //点击“参与方1”按钮
            if (word != '') {
                $("#w1").html(word);
                //console.log($("#t1").html());
                if ($("#participant1").length > 0) {
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace($("#participant1").prop("outerHTML"), $("#participant1").text());
                    })
                }
                $('#text').html(function(i, oldHTML) {

                    //标记文本
                    return oldHTML.replace(word, '<span style="color: orange;" id="participant1">' + word + '</span>');
                })
            }
            word = '';
        })
        $("#t2").html('参与方2');
        $("#event1_person2").click(function() { //点击“参与方2”按钮
            if (word != '') {
                $("#w2").html(word);
                if ($("#participant2").length > 0) {
                    $('#text').html(function(i, oldHTML) {
                        //删除之前的标记

                        return oldHTML.replace($("#participant2").prop("outerHTML"), $("#participant2").text());
                    })
                }
                $('#text').html(function(i, oldHTML) {

                    //标记文本
                    return oldHTML.replace(word, '<span style="color: green;" id="participant2">' + word + '</span>');
                })
            }
            word = '';
        })
        $("#t3").html('时间');
        $("#event1_date").click(function() { //点击“时间”按钮
            if (word != '') {
                $("#w3").html(word);
                if ($("#time").length > 0) {
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace($("#time").prop("outerHTML"), $("#time").text());
                    })
                }
                $('#text').html(function(i, oldHTML) {

                    //标记文本
                    return oldHTML.replace(word, '<span style="color: purple;" id="time">' + word + '</span>');
                })
            }
            word = '';
        })
        $("#t4").html('地点');
        $("#event1_place").click(function() { //点击“地点”按钮
            if (word != '') {
                $("#w4").html(word);

                if ($("#place").length > 0) {
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace($("#place").prop("outerHTML"), $("#place").text());
                    })
                }
                $('#text').html(function(i, oldHTML) {

                    //标记文本
                    return oldHTML.replace(word, '<span style="color: blue;" id="place">' + word + '</span>');
                })
            }
            word = '';
        })
    })
    $("#event2").click(function() {
        $('#text').html(function(i, oldHTML) {
            return oldHTML.replace($("#text").html(), $("#text").text());
        })
        $("#w").html(word);
        $("#w1").html('');
        $("#w2").html('');
        $("#w3").html('');
        $("#w4").html('');
        $("#t1").html('签署方');
        if (word != '') {
            $('#text').html(function(i, oldHTML) {
                    return oldHTML.replace(word, '<span style="color: red;" id="trigger">' + word + '</span>');
                }) //将选定文本内容添加上span标签修改样式
        }
        word = '';
        //console.log($("#t1").html());
        $("#event2_person").click(function() { //点击“参与方1”按钮
            if (word != '') {
                $("#w1").html(word);
                if ($("#signatory").length > 0) {
                    $('#text').html(function(i, oldHTML) {
                        //删除之前的标记

                        return oldHTML.replace($("#signatory").prop("outerHTML"), $("#signatory").text());
                    })
                }
                //console.log($("#t1").html());
                $('#text').html(function(i, oldHTML) {

                    //标记文本
                    return oldHTML.replace(word, '<span style="color: orange;" id="signatory">' + word + '</span>');
                })
            }
            word = '';
        })
        $("#t2").html('文件');
        $("#event2_document").click(function() { //点击“参与方2”按钮
            if (word != '') {
                $("#w2").html(word);
                if ($("#file").length > 0) {
                    $('#text').html(function(i, oldHTML) {
                        //删除之前的标记

                        return oldHTML.replace($("#file").prop("outerHTML"), $("#file").text());
                    })
                }
                $('#text').html(function(i, oldHTML) {

                    //标记文本
                    return oldHTML.replace(word, '<span style="color: purple;" id="file">' + word + '</span>');
                })
            }
            word = '';
        })
        $("#t3").html('签署时间');
        $("#event2_date").click(function() { //点击“时间”按钮
            if (word != '') {
                $("#w3").html(word);
                if ($("#time").length > 0) {
                    $('#text').html(function(i, oldHTML) {
                        //删除之前的标记

                        return oldHTML.replace($("#time").prop("outerHTML"), $("#time").text());
                    })
                }
                $('#text').html(function(i, oldHTML) {

                    //标记文本
                    return oldHTML.replace(word, '<span style="color: green;" id="time">' + word + '</span>');
                })
            }
            word = '';
        })
        $("#t4").html('签署地点');
        $("#event2_place").click(function() { //点击“地点”按钮
            if (word != '') {
                $("#w4").html(word);
                if ($("#place").length > 0) {
                    $('#text').html(function(i, oldHTML) {
                        //删除之前的标记

                        return oldHTML.replace($("#place").prop("outerHTML"), $("#place").text());
                    })
                }
                $('#text').html(function(i, oldHTML) {

                    //标记文本
                    return oldHTML.replace(word, '<span style="color: blue;" id="place">' + word + '</span>');
                })
            }
            word = '';
        })
    })
    $("#event3").click(function() {

        $('#text').html(function(i, oldHTML) {
            return oldHTML.replace($("#text").html(), $("#text").text());
        })
        $("#w").html(word);
        $("#w1").html('');
        $("#w2").html('');
        $("#w3").html('');
        $("#w4").html('');
        $("#t1").html('设施修建方');
        if (word != '') {
            $('#text').html(function(i, oldHTML) {
                return oldHTML.replace(word, '<span style="color: red;" id="trigger">' + word + '</span>');
            })
        }
        word = '';
        console.log($("#t1").html());
        $("#event3_person").click(function() { //点击“参与方1”按钮
            if (word != '') {
                $("#w1").html(word);
                //console.log($("#t1").html());
                if ($("#constructor").length > 0) {
                    $('#text').html(function(i, oldHTML) {
                        //删除之前的标记

                        return oldHTML.replace($("#constructor").prop("outerHTML"), $("#constructor").text());
                    })
                }
                $('#text').html(function(i, oldHTML) {

                    //标记文本
                    return oldHTML.replace(word, '<span style="color: green;" id="constructor">' + word + '</span>');
                })
            }

            word = '';
        })
        $("#t2").html('设施名称');
        $("#event3_name").click(function() { //点击“参与方2”按钮
            if (word != '') {
                $("#w2").html(word);
                if ($("#buildingName").length > 0) {
                    $('#text').html(function(i, oldHTML) {
                        //删除之前的标记

                        return oldHTML.replace($("#buildingName").prop("outerHTML"), $("#buildingName").text());
                    })
                }
                $('#text').html(function(i, oldHTML) {

                    //标记文本
                    return oldHTML.replace(word, '<span style="color: orange;" id="buildingName">' + word + '</span>');
                })
            }
            word = '';
        })
        $("#t3").html('启动时间');
        $("#event3_date").click(function() { //点击“时间”按钮
            if (word != '') {
                $("#w3").html(word);
                if ($("#time").length > 0) {
                    $('#text').html(function(i, oldHTML) {
                        //删除之前的标记

                        return oldHTML.replace($("#time").prop("outerHTML"), $("#time").text());
                    })
                }
                $('#text').html(function(i, oldHTML) {

                    //标记文本
                    return oldHTML.replace(word, '<span style="color: blue;" id="time">' + word + '</span>');
                })
            }
            word = '';
        })
        $("#t4").html('设施地点');
        $("#event3_place").click(function() { //点击“地点”按钮
            if (word != '') {
                $("#w4").html(word);
                if ($("#place").length > 0) {
                    $('#text').html(function(i, oldHTML) {
                        //删除之前的标记
                        return oldHTML.replace($("#place").prop("outerHTML"), $("#place").text());
                    })
                }
                $('#text').html(function(i, oldHTML) {

                    //标记文本
                    return oldHTML.replace(word, '<span style="color: purple;" id="place">' + word + '</span>');
                })
            }
            word = '';
        })
    })

    $("#event4").click(function() {
        $('#text').html(function(i, oldHTML) {
            return oldHTML.replace($("#text").html(), $("#text").text());
        })
        $("#w").html(word);
        $("#w1").html('');
        $("#w2").html('');
        $("#w3").html('');
        $("#w4").html('');
        $("#t1").html('举办方');
        if (word != '') {
            $('#text').html(function(i, oldHTML) {
                    return oldHTML.replace(word, '<span style="color: red;" id="trigger">' + word + '</span>');
                }) //将选定文本内容添加上span标签修改样式
        }
        word = '';
        //console.log($("#t1").html());
        $("#event4_person").click(function() { //点击“举办方”按钮
            if (word != '') {
                $("#w1").html(word);

                if ($("#holder").length > 0) {
                    //删除之前的标记

                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace($("#holder").prop("outerHTML"), $("#holder").text());
                    })
                }
                $('#text').html(function(i, oldHTML) {

                    //标记文本
                    return oldHTML.replace(word, '<span style="color: green;" id="holder">' + word + '</span>');
                })
            }
            //console.log($("#t1").html());
            word = '';
        })
        $("#t2").html('活动名称');
        $("#event4_name").click(function() { //点击“活动名称”按钮
            if (word != '') {
                $("#w2").html(word);
                if ($("#name").length > 0) {
                    $('#text').html(function(i, oldHTML) {
                        //删除之前的标记

                        return oldHTML.replace($("#name").prop("outerHTML"), $("#name").text());
                    })
                }
                $('#text').html(function(i, oldHTML) {

                    //标记文本
                    return oldHTML.replace(word, '<span style="color: orange;" id="name">' + word + '</span>');
                })
            }
            word = '';
        })
        $("#t3").html('活动地点');
        $("#event4_place").click(function() { //点击“活动地点”按钮
            if (word != '') {
                $("#w3").html(word);
                if ($("#place").length > 0) {
                    $('#text').html(function(i, oldHTML) {
                        //删除之前的标记
                        return oldHTML.replace($("#place").prop("outerHTML"), $("#place").text());
                    })
                }
                $('#text').html(function(i, oldHTML) {

                    //标记文本
                    return oldHTML.replace(word, '<span style="color: blue;" id="place">' + word + '</span>');
                })
            }
            word = '';
        })
        $("#t4").html('活动时间');
        $("#event4_date").click(function() { //点击“活动时间”按钮
            if (word != '') {
                $("#w4").html(word);
                if ($("#time").length > 0) {
                    //删除之前的标记
                    $('#text').html(function(i, oldHTML) {
                        return oldHTML.replace($("#time").prop("outerHTML"), $("#time").text());
                    })
                }
                $('#text').html(function(i, oldHTML) {


                    //标记文本
                    return oldHTML.replace(word, '<span style="color: purple;" id="time">' + word + '</span>');
                })
            }
            word = '';
        })
    })
</script>

</html>